<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AIJOE</title>

  <!-- Styles & scripts -->
  <link rel="stylesheet" href="style.css?v=9">
  <script defer src="index.js?v=9"></script>
  <script defer src="script.js?v=9"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: #000;
      color: #fff;
      text-align: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .background {
      background: url("joey.png?v=9") center/cover no-repeat;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      filter: brightness(0.6); /* darken slightly for readability */
    }
    h1 {
      margin: 16px;
      font-size: 28px;
      text-shadow: 0 2px 6px rgba(0,0,0,0.7);
    }
    .overlay {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 16px;
    }
    .card {
      background: rgba(17, 24, 39, 0.8);
      border-radius: 16px;
      padding: 16px;
      max-width: 600px;
      width: 100%;
      margin-bottom: 20px;
      backdrop-filter: blur(4px);
    }
    .row { display:flex; gap:8px; }
    input[type="text"] {
      flex:1; padding:12px; border-radius:12px;
      border:1px solid #334155;
      background:#0b1220; color:#e2e8f0;
    }
    button {
      padding:12px 16px; border-radius:12px; border:0;
      background:#22c55e; color:#0b1220; font-weight:700; cursor:pointer;
    }
    .out {
      background:rgba(11,18,32,0.8);
      border:1px solid #334155;
      border-radius:12px;
      padding:12px; min-height:80px; margin-top:12px;
      text-align:left; backdrop-filter: blur(4px);
    }
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap:16px;
      width: 100%;
      max-width: 900px;
    }
    .grid .card {
      cursor:pointer;
      transition:0.2s;
      text-align:center;
    }
    .grid .card:hover {
      background: rgba(30,41,59,0.9);
    }
  </style>
</head>
<body>
  <!-- Joey background -->
  <div class="background"></div>

  <h1>AIJOE HELLO 🐶</h1>

  <div class="overlay">
    <!-- Ask Joey box -->
    <div class="card">
      <div class="row">
        <input id="userText" type="text" placeholder="Ask Joey anything…" />
        <button id="askBtn">Ask</button>
      </div>
      <div id="reply" class="out" aria-live="polite"></div>
    </div>

    <!-- Feature grid -->
    <div class="grid">
      <div class="card" onclick="getBibleVerse()"><h3>📖 Bible Verse</h3></div>
      <div class="card" onclick="getJoke()"><h3>😂 Joke</h3></div>
      <div class="card" onclick="getWeather()"><h3>☀️ Weather</h3></div>
      <div class="card" onclick="getGPS()"><h3>📍 GPS</h3></div>
      <div class="card" onclick="playMusic()"><h3>🎵 Music</h3></div>
      <div class="card" onclick="helpMeFix()"><h3>🛠️ Help Me Fix</h3></div>
      <div class="card" onclick="emergencyHelp()"><h3>🚨 Emergency</h3></div>
      <div class="card" onclick="selfHelp()"><h3>💡 Self Help</h3></div>
    </div>
  </div>

  <!-- === FOOTER PATCH === -->
  <script>
    // Endpoint
    window.AIJOE_ENDPOINT = "https://aixqz.life/.netlify/functions/askAI";

    // Ask Joey
    async function askAI(userText) {
      const res = await fetch(window.AIJOE_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: userText }),
      });
      if (!res.ok) throw new Error("Bad response " + res.status);
      const data = await res.json();
      return data.reply || "(no reply)";
    }

    // Wire up input
    const btn = document.getElementById("askBtn");
    const input = document.getElementById("userText");
    const replyBox = document.getElementById("reply");

    async function onAsk() {
      const msg = input.value.trim();
      if (!msg) return;
      replyBox.textContent = "Joey is thinking… 🐾";
      try {
        const reply = await askAI(msg);
        replyBox.textContent = reply;
      } catch (e) {
        replyBox.textContent = "Network error ❌";
        console.error(e);
      }
    }
    btn.addEventListener("click", onAsk);
    input.addEventListener("keydown", e => { if (e.key === "Enter") onAsk(); });

    // Placeholder feature functions
    <script>
// ===== Replace your placeholder feature functions with EVERYTHING in this block =====

// Helper: show text in the reply box
const replyBox = document.getElementById("reply");
function show(msg) { replyBox.textContent = msg; }

// 1) 📖 Bible Verse (tries an API, falls back to a local verse)
async function getBibleVerse() {
  show("📖 Getting today's verse…");
  try {
    // Bible.org VOTD (json) — no key required
    const res = await fetch("https://labs.bible.org/api/?passage=votd&type=json");
    if (!res.ok) throw new Error("VOTD request failed");
    const data = await res.json();
    if (Array.isArray(data) && data[0]?.text) {
      const v = data[0];
      show(`📖 ${v.bookname} ${v.chapter}:${v.verse}\n“${v.text.trim()}”`);
      return;
    }
    throw new Error("Unexpected VOTD shape");
  } catch (e) {
    console.warn("Bible API failed, using fallback:", e);
    // Fallback (ESV public domain alt) — static verse if API blocked
    show(`📖 Psalm 23:1\n“ The Lord is my shepherd; I shall not want. ”`);
  }
}

// 2) 😂 Joke (JokeAPI, with fallback)
async function getJoke() {
  show("😂 Fetching a fresh joke…");
  try {
    const res = await fetch("https://v2.jokeapi.dev/joke/Any?type=single&safe-mode");
    if (!res.ok) throw new Error("Joke request failed");
    const data = await res.json();
    if (data?.joke) {
      show(`😂 ${data.joke}`);
    } else {
      throw new Error("Unexpected joke shape");
    }
  } catch (e) {
    console.warn("Joke API failed, using fallback:", e);
    const fallbacks = [
      "Why did the web dev go broke? Because he used up all his cache.",
      "I told my computer I needed a break… it said 'No problem, I’ll go to sleep.'",
      "Why did the function return early? It had nothing to declare."
    ];
    show("😂 " + fallbacks[Math.floor(Math.random() * fallbacks.length)]);
  }
}

// 3) 📍 GPS (gets your location and shows a Google Maps link)
function getGPS() {
  show("📍 Getting your location…");
  if (!navigator.geolocation) {
    show("📍 Geolocation not supported on this device.");
    return;
  }
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const { latitude, longitude } = pos.coords;
      const maps = `https://www.google.com/maps?q=${latitude},${longitude}`;
      show(`📍 Location found:\nLat: ${latitude.toFixed(5)}, Lng: ${longitude.toFixed(5)}\nOpen: ${maps}`);
      // Optionally auto-open a new tab:
      // window.open(maps, "_blank");
    },
    (err) => {
      show("📍 Location failed. Please allow location access in your browser settings.");
      console.error(err);
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
  );
}

// 4) ☀️ Weather (free, no key; uses Open-Meteo + your GPS)
async function getWeather() {
  show("☀️ Getting weather near you…");
  if (!navigator.geolocation) {
    show("☀️ Geolocation not supported on this device.");
    return;
  }
  navigator.geolocation.getCurrentPosition(async (pos) => {
    try {
      const { latitude, longitude } = pos.coords;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Weather request failed");
      const data = await res.json();
      const cw = data.current_weather;
      if (!cw) throw new Error("No current_weather");
      // Open-Meteo returns temperature in °C by default
      const tempC = cw.temperature;
      const wind = cw.windspeed;
      const code = cw.weathercode;
      show(`☀️ Current weather:
• Temp: ${tempC}°C
• Wind: ${wind} km/h
• Code: ${code}
( lat ${latitude.toFixed(2)}, lon ${longitude.toFixed(2)} )`);
    } catch (e) {
      console.error(e);
      show("☀️ Couldn't fetch weather right now.");
    }
  }, (err) => {
    show("☀️ Weather needs location permission. Please allow it.");
    console.error(err);
  }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
}

// 5) 🎵 Music (opens your YouTube playlist or song)
function playMusic() {
  // TODO: replace with your favorite playlist URL
  const url = "https://www.youtube.com/results?search_query=lofi+hip+hop";
  show("🎵 Opening music…");
  window.open(url, "_blank");
}

// 6) 🛠️ Help Me Fix (simple starter; you can route to askAI later)
function helpMeFix() {
  show("🛠️ Tell me what broke and I’ll guide you step by step.");
  // Example: you could focus the Ask box so user can type
  const input = document.getElementById("userText");
  input?.focus();
}

// 7) 🚨 Emergency (shows numbers; on mobile, tap to call)
function emergencyHelp() {
  show("🚨 If you are in danger, call local emergency services.\n• 911 (US): tel:911\n• Fire: tel:911\n• Medical: tel:911");
  // Optionally add a confirm dialog to open dialer:
  // if (confirm("Call 911 now?")) location.href = "tel:911";
}

// 8) 💡 Self Help (quick calming steps)
function selfHelp() {
  show(
`💡 Quick reset:
1) Breathe in 4s, hold 4s, out 6s (x5).
2) Drink water.
3) Short walk with Joey.
4) One small win: pick a tiny task and finish it.
5) If overwhelmed, ask Joey: "Help me plan my next 3 steps."`
  );
}

// ===== End of replacement block =====
</script>

    // Health check
    fetch(window.AIJOE_ENDPOINT, { method: "GET" })
      .then(r => r.json())
      .then(j => console.log("AIJOE health:", j))
      .catch(e => console.warn("AIJOE not reachable:", e));

    // Register Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js?v=9").catch(console.error);
    }
  </script>
  <!-- === END FOOTER PATCH === -->
<script>
// === AIJOE FEATURE FUNCTIONS (global) ===
// Helper to display text in the reply box
const replyBox = document.getElementById("reply");
function show(msg) { if (replyBox) replyBox.textContent = msg; }

// 1) 📖 Bible Verse (API + fallback)
window.getBibleVerse = async function () {
  show("📖 Getting today's verse…");
  try {
    const res = await fetch("https://labs.bible.org/api/?passage=votd&type=json");
    if (!res.ok) throw new Error("VOTD request failed");
    const data = await res.json();
    if (Array.isArray(data) && data[0]?.text) {
      const v = data[0];
      show(`📖 ${v.bookname} ${v.chapter}:${v.verse}\n“${v.text.trim()}”`);
      return;
    }
    throw new Error("Unexpected VOTD shape");
  } catch (e) {
    console.warn("Bible API failed, fallback:", e);
    show(`📖 Psalm 23:1\n“ The Lord is my shepherd; I shall not want. ”`);
  }
};

// 2) 😂 Joke (API + fallback)
window.getJoke = async function () {
  show("😂 Fetching a fresh joke…");
  try {
    const res = await fetch("https://v2.jokeapi.dev/joke/Any?type=single&safe-mode");
    if (!res.ok) throw new Error("Joke request failed");
    const data = await res.json();
    if (data?.joke) show(`😂 ${data.joke}`);
    else throw new Error("Unexpected joke shape");
  } catch (e) {
    console.warn("Joke API failed, fallback:", e);
    const fallbacks = [
      "Why did the web dev go broke? Because he used up all his cache.",
      "I told my computer I needed a break… it said 'No problem, I’ll go to sleep.'",
      "Why did the function return early? It had nothing to declare."
    ];
    show("😂 " + fallbacks[Math.floor(Math.random() * fallbacks.length)]);
  }
};

// 3) 📍 GPS (maps link)
window.getGPS = function () {
  show("📍 Getting your location…");
  if (!navigator.geolocation) return show("📍 Geolocation not supported.");
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const { latitude, longitude } = pos.coords;
      const maps = `https://www.google.com/maps?q=${latitude},${longitude}`;
      show(`📍 Location:\nLat: ${latitude.toFixed(5)}, Lng: ${longitude.toFixed(5)}\nOpen: ${maps}`);
      // window.open(maps, "_blank");
    },
    (err) => { show("📍 Please allow location access."); console.error(err); },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
  );
};

// 4) ☀️ Weather (Open-Meteo)
window.getWeather = function () {
  show("☀️ Getting weather near you…");
  if (!navigator.geolocation) return show("☀️ Geolocation not supported.");
  navigator.geolocation.getCurrentPosition(async (pos) => {
    try {
      const { latitude, longitude } = pos.coords;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Weather request failed");
      const data = await res.json();
      const cw = data.current_weather;
      if (!cw) throw new Error("No current_weather");
      show(`☀️ Current weather:
• Temp: ${cw.temperature}°C
• Wind: ${cw.windspeed} km/h
• Code: ${cw.weathercode}
( lat ${latitude.toFixed(2)}, lon ${longitude.toFixed(2)} )`);
    } catch (e) { console.error(e); show("☀️ Couldn't fetch weather right now."); }
  }, (err) => { show("☀️ Please allow location access."); console.error(err); },
  { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
};

// 5) 🎵 Music (open YouTube or your playlist)
window.playMusic = function () {
  const url = "https://www.youtube.com/results?search_query=lofi+hip+hop"; // change to your playlist
  show("🎵 Opening music…");
  window.open(url, "_blank");
};

// 6) 🛠️ Help Me Fix
window.helpMeFix = function () {
  show("🛠️ Tell me what broke and I’ll guide you step by step.");
  document.getElementById("userText")?.focus();
};

// 7) 🚨 Emergency
window.emergencyHelp = function () {
  show("🚨 If you are in danger, call 911 (US).");
  // if (confirm("Call 911 now?")) location.href = "tel:911";
};

// 8) 💡 Self Help
window.selfHelp = function () {
  show(`💡 Quick reset:
1) Breathe in 4s, hold 4s, out 6s (x5).
2) Drink water.
3) Short walk with Joey.
4) One small win: pick a tiny task and finish it.
5) Ask Joey: "Help me plan my next 3 steps."`);
};
</script>
<script>
  // Register SW after page load (avoids timing issues)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker
        .register('/service-worker.js?v=11', { scope: '/' })
        .then(reg => console.log('SW registered:', reg.scope))
        .catch(err => console.error('SW registration failed:', err));
    });
  } else {
    console.warn('Service workers not supported in this browser');
  }
</script>
<body>
</html>
